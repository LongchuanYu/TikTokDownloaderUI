{% extends "base.html" %} {% block title %}ä¸»é¡µ{% endblock %} {% block head %}
<style>
  body {
    margin-bottom: 60px;
  }
  .tabbar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: #fff;
    border-top: 1px solid #ddd;
    display: flex;
  }
  .tab-item {
    flex: 1;
    text-align: center;
    line-height: 60px;
    color: #666;
    cursor: pointer;
  }
  .tab-item.active {
    color: #0d6efd;
    font-weight: bold;
  }
  .page {
    display: none;
    padding: 15px;
  }
  .page.active {
    display: block;
  }
</style>
{% endblock %} {% block content %}

<!-- ä¸»é¡µ -->
<div id="page-home" class="page active">
  <h4 class="mb-3">ä¸»é¡µ</h4>

  <div class="mb-3">
    <input
      type="text"
      id="inputText"
      class="form-control"
      placeholder="ç‚¹å‡»ç²˜è´´æˆ–è¾“å…¥"
    />
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-secondary flex-fill" onclick="focusInput()">
      ç²˜è´´
    </button>
    <button class="btn btn-primary flex-fill" onclick="confirmInput()">
      ç¡®è®¤
    </button>
  </div>

  <div class="mt-3">
    <div id="resultBox" class="alert alert-info d-none"></div>
  </div>
</div>

<!-- æˆ‘çš„ -->
<div id="page-me" class="page">
  <h4 class="mb-3">æˆ‘çš„</h4>
  <p>ç”¨æˆ·ï¼š{{ current_user.username }}</p>
  <a href="/logout" class="btn btn-danger w-100 mt-4">æ³¨é”€ç™»å½•</a>
</div>

<!-- TabBar -->
<div class="tabbar">
  <div class="tab-item active" onclick="switchTab('home')">ğŸ  ä¸»é¡µ</div>
  <div class="tab-item" onclick="switchTab('me')">ğŸ‘¤ æˆ‘çš„</div>
</div>

{% endblock %} {% block script %}
<script>
  function switchTab(tab) {
    document.getElementById("page-home").classList.remove("active");
    document.getElementById("page-me").classList.remove("active");
    document
      .querySelectorAll(".tab-item")
      .forEach((el) => el.classList.remove("active"));

    if (tab === "home") {
      document.getElementById("page-home").classList.add("active");
      document.querySelectorAll(".tab-item")[0].classList.add("active");
    } else {
      document.getElementById("page-me").classList.add("active");
      document.querySelectorAll(".tab-item")[1].classList.add("active");
    }
  }

  function focusInput() {
    const input = document.getElementById("inputText");
    input.focus();
    input.select();
  }

  async function confirmInput() {
    const input = document.getElementById("inputText");
    const resultBox = document.getElementById("resultBox");
    const value = input.value.trim();

    if (!value) {
      alert("è¯·è¾“å…¥å†…å®¹");
      return;
    }

    resultBox.classList.add("d-none");

    try {
      const resp = await fetch("/api/confirm", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ text: value }),
      });

      const data = await resp.json();

      if (!data.success) {
        resultBox.className = "alert alert-danger";
        resultBox.innerText = data.message;
      } else {
        resultBox.className = "alert alert-success";
        resultBox.innerText = data.result;
      }

      resultBox.classList.remove("d-none");
    } catch (e) {
      resultBox.className = "alert alert-danger";
      resultBox.innerText = "è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ";
      resultBox.classList.remove("d-none");
    }
  }
</script>
{% endblock %}
